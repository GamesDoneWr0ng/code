data = """...#........................................#........#.................#............#.#.......................#...............#..#
...#........#.....#..................................................................................#......#..#..................
.................#.......................#.#........#......#...........................................#...#..........#...........
..................#..................#...#.....................................#........#.........................................
...#.....#.......#..............#.#....##.............#....##......................................#...................#..........
...#..........................................................................................................................#...
..#..#.............#.....#...............#.......#..............................................#....#............................
......................#..#...............#...................#....#..........................#...#............#...#....##.........
..#.#.........#................#............#............#.#.......#................#....#..#.....................................
.......................................................................#.....................................#...........#........
...........#.....................................................................#.................................#......#.......
...#.........#....................................................#..............#.............#..........#.......................
.................................................................................................#................................
..................................#.#.#...#.......#.............#.......................#..#.......................#.#............
.......................#.........................................#..........#...#.....#....................................#......
.......#.......#.#...........#......................#.....#..#...#.#...............#.............................#...#............
............##...#......#.........#......#............................................................#.........#..............#..
..#........................................#........##..#...............................................................#.........
...........#..............##................................................................................#.....................
..#................................................................................#..............#...............................
...................................##..............#..........................#.......#..#...............#........#...............
....#............#.........................#................................................................#........#............
............#.....................................................................#.............................................#.
............#..........#.......#...........#.#......#..............#.........#.......................................#......#.....
..#...............................................#..................................#.............................#.............#
.........................................................................#........#................#......#.......#....#........#.
.......................................................................#.....##.................................................#.
..............#.............#...........................#...#..#....................................................#.............
.......#..........................#.......................###..................................#.....................#..#.........
................#.................#.............#......................................................................#........#.
.#.....#................#......................................................................#................#.................
................................#........................#........#..#........................#...................................
..............................................................................................#.....................#.........#...
..................#.................#.........................#.....#................#............................................
......#...................#...#...................#..................#...........................#......###...................#...
.............................##.....#..............#..............................................................#....#..........
......#..................#....................................................###....................#..............#.............
............#...#..................#........#.............#..............................#.........#..........................#...
....#...............................#......#......#...............#.#......#............#...................................#.....
.......#...................................#.#.#.........................................................#..................#.....
.....................#.......#.#......#.#.....................#...................................................................
......#.....#............................................................................#............#.......#..#................
..........#.#......#...................................#....#.#............##.....................................................
...............#........................#..................................#...........#...................................#......
.#....................................................#.......................................................................#...
......#.........................................#...#.........................................#........#..........................
.........................................#..........#.............................................................................
...................#.....................................#.....................#..#............#....#........................##...
.................................#.........#.............#.............................#...........................#...#..........
..#................................................................#.....#....#.................................#.................
........#................#............#.#..........................................#..............................................
..#...........##.....................#..#..........................#...#...#....#.................................................
................................................................................#.................................................
............#...........#.........#....#.........................................................................#................
.............................#...........................................#...............##...................................#...
......................#..............#...#........................#........................................#......................
............#..............#...#.....#.....#..........#...........................#........#...............#......................
..................#............................#....#................................................................#............
..#........................#.............................#......#...............#....#...........#................................
.................................................#................................................#..................#........#...
.#......#.........................................................#...........#...#.......................#.......................
..........................................#.......##........#................................................#..##............##..
..............#...#....................................................................#........#...........................#.....
................#....................................................................#........................................###.
....#............................................#........................#.................#........#.....#...#.....#.#....#.....
...##..........#..................................................................................................................
#....#.........#....................#.#.........................#..........##.......#....#..#....................#................
........#.........#..........#.................#..................#................................#.......#................#...#.
.#..........................................#..#..#......#................................#.#.#..#................................
....#.......#.........#............................................................#....#.........................................
.....................................................................#...#......................#.................................
............#.....#.....#..........#...............................................................................#..............
.........................#...#.#.......#....................................................................#.................#...
......................................................#.#..........................#...#................#.........................
.....#.........#.........#..............................................................#...................#.#......#............
.......................................#......#.......................#.................................................#.....#...
.....#....#.......................................................................................................................
#..........#....#....................................#.............#...............#...................#..........#...............
..#....................................##.....................................#...............................#...................
....#..................................#........................#.................................................................
....#................................................................................................#...................#........
....#................................................................................#............................................
..........#.....#...................#.......................#......#..............................................................
#...................#..........#............................................................#............#..............#.........
...#...#....#................................#............................#.##.....................................#..............
..........#.........#.....#...........#............................#...............#.#....#................#....................##
.....#...................................................#........................................................................
............##....................................#..................#.#..#.....................#.........#....##......#...#......
...........#.......#....................#.......................#..#.................#.......#.........#..........................
#.....................#..#..............................................................................................#.........
....#....#..............#............##....................................................^.................#..............#.....
.........#......................................................#..............#............#...#......#....#.....................
.......##...................#...........#.........#.......................................#..........................#............
.#........#.#........................#...........#............#..#........#........#.............#................................
..................##........##.................................................................................#................#.
...#...................#.....#...........#.........#..#............#..................................#.....#.....................
.................#.........#..........#............#......#.........................#.............#.......#......................#
.................................................................#...............#.....#.#....#...................................
..........................#...........................................................................................#..#........
..............#.................................................................................##......................#.........
....#...#....................#...............................................#................#............#......................
........................................................................#........#................................................
....#.....#......................#.......#............#......................................#..................................#.
................#................................#.#.............#.#.........#..............................................#.....
..............#..................#...#...........................................................................#................
...#..........#....................................................#...............................#...........#.......#..........
...................................#....................#..#.#........#..#.......................#...#.....#......................
.......#.....#.#.......#....#............#...............#..........#.................#........#.#................................
.....#....#.........#........#.......#............................................................................................
..#........#......#............................................................#..........#...............................#.......
..#..#...................................#....................#...#.#................#......................#.....................
....................................#......#.....................#...........#.....................#........#.....................
.#..................#.........................................................................................................#...
..............#...........#.#....#..#......#..#.#...#.#.........................................................................#.
...#............##.......................................................#.......................#..#.............................
......#........#..........#..#.#........#.....................#...................................................................
...#...........#.........................................#............#.............#....#.....................................#..
...........#.....................#......................................................................................#.........
.......#..............#...............#............#..........................#............................#........##............
.............#..........#..............................................#................#..............................#..........
...............#..............................#.................#.....#................#....#.....................................
............#.................#..........#........#............#..#......#.......................#....#...#.#...#.#...............
.......#.#...................................##..............#.....#.....................#.................................##.....
..#..#...#...#....#.............#..#.....................................................................................#........
......#......................#...#...#..........#......................................#.................#....#.................#.
.......#...........#...........#...................#..............................#.......................................#.......
......#.......................................#...............................................#.........#........#....#.........##
......#.................................................................#...#............#..........#.............................
.....................................#..........#.........#.....#.............#...........#.......................................
.#.....................................#......................#.....#..#.........................................................."""

m = dict()
guard = 0
for y, r in enumerate(data.split("\n")):
    for x, l in enumerate(r.strip()):
        pos = x + y*1j
        if l == "^":
            guard = pos
            m[pos] = "."
        else:
            m[pos] = l

def explore(m, guard):
    dir = -1j
    visited = {guard}
    posDir = {(guard, dir)}

    while True:
        newPos = guard + dir
        if newPos not in m:
            return visited
        elif m[newPos]==".":
            if (newPos, dir) in posDir:
                return -1
            visited.add(newPos)
            posDir.add((newPos, dir))
            guard = newPos
        elif m[newPos] == "#":
            dir *= 1j

#print(len(explore(m, guard)))

loops = 0
tiles = explore(m, guard)
for index, pos in enumerate(list(tiles)):
    if index % 1000 == 0:
        print(f"{index}/{len(tiles)}")
    if m[pos] != "#":
        m[pos] = "#"
        if explore(m, guard) == -1:
            loops += 1
            print(f"{int(pos.real)}, {int(pos.imag)}")
        m[pos] = "."

print(loops)
